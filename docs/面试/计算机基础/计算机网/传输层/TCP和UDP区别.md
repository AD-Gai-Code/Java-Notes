###  Tcp 和 UDP 的区别

![TCP、UDP协议的区别](https://gitee.com/AD-Gai-Code/pic-go/raw/master/202110221907413.jpeg)

`TCP`是面向连接的，`UDP` 是面向无连接的。

什么叫面向连接，什么叫无连接呢？在互通之前，面向连接的协议会先建立连接。例如， `TCP` 会三次握手，而 `UDP` 不会。

**所谓的建立连接，是为了在客户端和服务端维护连接，而建立一定的数据结构来维护双方交互的状态，用这样的数据结构来保证所谓的面向连接的特性。**

1. `TCP` 提供可靠交付。通过 `TCP` 连接传输的数据，无差错、不丢失、不重复、并且按序到达。我们都知道 `IP` 包是没有任何可靠性保证的，一旦发出去，就像西天取经，走丢了、被妖怪吃了，都只能随它去。但是 `TCP` 号称能做到那个连接维护的程序做的事情。而`UDP` 继承了 `IP` 包的特性，不保证不丢失，不保证按顺序到达。

2. `TCP` 是面向字节流的。发送的时候发的是一个流，没头没尾。`IP` 包可不是一个流， 而是一个个的 `IP` 包。之所以变成了流，这也是 `TCP` 自己的状态维护做的事情。而`UDP` 继承了 `IP` 的特性，基于数据报的，一个一个地发，一个一个地收。

3. `TCP` 是可以有拥塞控制的。它意识到包丢弃了或者网络的环境不好了，就会根据情况调整自己的行为，看看是不是发快了，要不要发慢点。`UDP` 就不会，应用让我发，我就发，管它洪水滔天。

4. 而`TCP` 其实是一个有状态服务，通俗地讲就是有脑子的，里面精确地记着发送了没有， 接收到没有，发送到哪个了，应该接收哪个了，错一点儿都不行。而 **UDP 则是无状态服务。** 通俗地说是没脑子的，天真无邪的，发出去就发出去了。

###  基于 UDP 的例子

####  一:  网页或者 APP 的访问

原来访问网页和手机 `APP` 都是基于 `HTTP` 协议的。`HTTP` 协议是基于 `TCP` 的，建立连接都 需要多次交互，对于时延比较大的目前主流的移动互联网来讲，建立一次连接需要的时间会比较长，然而既然是移动中，`TCP` 可能还会断了重连，也是很耗时的。而且目前的 `HTTP` 协议，往往采取多个数据通道共享一个连接的情况，这样本来为了加快传输速度，但是 `TCP` 的严格顺序策略使得哪怕共享通道，前一个不来，后一个和前一个即便没关系，也要等着，时延也会加大。

####  二：流媒体的协议

现在直播比较火，直播协议多使用 `RTMP`，这个协议我们后面的章节也会讲，而这个 `RTMP` 协议也是基于 `TCP` 的。`TCP` 的严格顺序传输要保证前一个收到了，下一个才能确 认，如果前一个收不到，下一个就算包已经收到了，在缓存里面，也需要等着。对于直播来 讲，这显然是不合适的，因为老的视频帧丢了其实也就丢了，就算再传过来用户也不在意 了，他们要看新的了，如果老是没来就等着，卡顿了，新的也看不了，那就会丢失客户，所 以直播，实时性比较比较重要，宁可丢包，也不要卡顿的。 另外，对于丢包，其实对于视频播放来讲，有的包可以丢，有的包不能丢，因为视频的连续 帧里面，有的帧重要，有的不重要，如果必须要丢包，隔几个帧丢一个，其实看视频的人不 会感知，但是如果连续丢帧，就会感知了，因而在网络不好的情况下，应用希望选择性的丢 帧。 还有就是当网络不好的时候，`TCP` 协议会主动降低发送速度，这对本来当时就卡的看视频 来讲是要命的，应该应用层马上重传，而不是主动让步。因而，很多直播应用，都基于 `UDP` 实现了自己的视频传输协议。

####  三：实时游戏

游戏有一个特点，就是实时性比较高。快一秒你干掉别人，慢一秒你被别人爆头，所以很多职业玩家会买非常专业的鼠标和键盘，争分夺秒。 

因而，实时游戏中客户端和服务端要建立长连接，来保证实时传输。但是游戏玩家很多，服务器却不多。由于维护 `TCP` 连接需要在内核维护一些数据结构，因而一台机器能够支撑的 `TCP` 连接数目是有限的，然后 `UDP` 由于是没有连接的，在异步 `IO` 机制引入之前，常常是应对海量客户端连接的策略。 

另外还是 `TCP` 的强顺序问题，对战的游戏，对网络的要求很简单，玩家通过客户端发送给 服务器鼠标和键盘行走的位置，服务器会处理每个用户发送过来的所有场景，处理完再返回给客户端，客户端解析响应，渲染最新的场景展示给玩家。

